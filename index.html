<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Alien Action</title>
<style>
body { margin: 0; overflow: hidden; font-family: 'Arial', sans-serif; background: #000; }

#info {
    position: absolute;
    top: 20px;
    left: 20px;
    background: rgba(0,0,0,0.8);
    padding: 20px;
    border-radius: 10px;
    border: 2px solid #00ffff;
    color: white;
    z-index: 100;
}
#info h2 { margin: 0 0 10px 0; font-size: 24px; color: #00ffff; }
.stat { margin: 8px 0; font-size: 16px; }

#modeToggle {
    position: absolute;
    top: 20px;
    right: 20px;
    padding: 15px 30px;
    background: linear-gradient(135deg,#f093fb,#f5576c);
    border: none;
    border-radius: 10px;
    color: white;
    font-size: 18px;
    cursor: pointer;
    z-index: 100;
}

#controls {
    position: absolute;
    bottom: 30px;
    left: 50%;
    transform: translateX(-50%);
    display: flex;
    gap: 15px;
    z-index: 100;
}

#controls button {
    padding: 15px 30px;
    font-size: 18px;
    cursor: pointer;
    background: linear-gradient(135deg, #667eea, #764ba2);
    color: white;
    border: none;
    border-radius: 10px;
    font-weight: bold;
}

#gameOver {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    background: rgba(0,0,0,0.95);
    padding: 40px;
    border-radius: 20px;
    border: 3px solid #ff00ff;
    color: white;
    text-align: center;
    display: none;
    z-index: 200;
}
canvas { display: block; }
</style>
</head>
<body>

<div id="info">
<h2>Alien Action</h2>
<div style="font-size:12px;color:#888;margin-bottom:10px;">Group ID: 6321</div>
<div class="stat">Score: <span id="score">0</span></div>
<div class="stat">Speed: <span id="speed">1.0x</span></div>
<div class="stat">Combo: <span id="combo">0</span></div>
<div class="stat">Mode: <span id="mode">Prototype</span></div>
</div>

<button id="modeToggle">Switch to Full Mode</button>

<div id="controls">
<button id="left">←</button>
<button id="jump">JUMP</button>
<button id="right">→</button>
</div>

<div id="gameOver">
<h1 style="color:#ff00ff;font-size:48px;margin:0;">GAME OVER!</h1>
<p style="font-size:24px;margin:20px 0;">Final Score:
<span id="finalScore" style="color:#00ffff;">0</span></p>
<p style="font-size:18px;color:#888;">Max Combo:
<span id="maxCombo" style="color:#ffff00;">0</span></p>
<button id="restart" style="margin-top:20px;">Play Again</button>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
<script>

let scene, camera, renderer;
let player;
let platforms=[], obstacles=[], collectibles=[], particles=[];
let score=0, combo=0, maxCombo=0;
let speed=0.15;
let prototype=true;
let running=true;
let jumping=false, jumpVel=0, lane=0;
const laneWidth=3, gravity=-0.02, jumpPower=0.35;

function init() {
    scene=new THREE.Scene();
    scene.fog=new THREE.Fog(0x000000,10,80);

    camera=new THREE.PerspectiveCamera(75,innerWidth/innerHeight,0.1,1000);
    camera.position.set(0,8,12);
    camera.lookAt(0,2,-10);

    renderer=new THREE.WebGLRenderer({antialias:true});
    renderer.setSize(innerWidth,innerHeight);
    document.body.appendChild(renderer.domElement);

    lights();
    createPlayer();
    createInitialPlatforms();
    createTunnel();
    inputs();
    animate();
}

function lights() {
    const a=new THREE.AmbientLight(0x404040, prototype?0.5:1.4);
    scene.add(a);

    const d=new THREE.DirectionalLight(0xffffff, prototype?0.8:1.4);
    d.position.set(0,10,10);
    scene.add(d);

    if(!prototype){
        const p1=new THREE.PointLight(0x00ffff,2,50);
        p1.position.set(-5,5,-10);
        scene.add(p1);

        const p2=new THREE.PointLight(0xff00ff,2,50);
        p2.position.set(5,5,-10);
        scene.add(p2);
    }
}

function createPlayer() {
    if(player)scene.remove(player);
    player=new THREE.Group();

    if(prototype){
        player.add(new THREE.Mesh(
            new THREE.BoxGeometry(1,1,1),
            new THREE.MeshPhongMaterial({color:0x00ff00})
        ));
    } else {
        player.add(new THREE.Mesh(
            new THREE.IcosahedronGeometry(0.9,1),
            new THREE.MeshStandardMaterial({
                color:0x00ff00,
                emissive:0x003300,
                metalness:0.7,
                roughness:0.2
            })
        ));

        const aura=new THREE.Mesh(
            new THREE.SphereGeometry(1.4,16,16),
            new THREE.MeshBasicMaterial({color:0x00ffff,transparent:true,opacity:0.15})
        );
        player.add(aura);
    }

    player.position.set(0,2,0);
    scene.add(player);
}

function createPlatform(z){
    const g=new THREE.Group();
    for(let i=-1;i<=1;i++){
        const mat=prototype
            ? new THREE.MeshPhongMaterial({color:0x444444})
            : new THREE.MeshStandardMaterial({
                color:0x222255,
                emissive:0x110022,
                metalness:0.6,
                roughness:0.25
            });

        const seg=new THREE.Mesh(
            new THREE.BoxGeometry(2.5,0.5,10),
            mat
        );
        seg.position.set(i*laneWidth,0,0);
        g.add(seg);
    }
    g.position.z=z;
    scene.add(g);
    platforms.push(g);

    if(Math.random()<0.4)createObstacle(z);
    else if(Math.random()<0.6)createCollectible(z);
}

function createObstacle(z){
    const l=Math.floor(Math.random()*3)-1;
    const g=new THREE.Group();

    if(prototype){
        g.add(new THREE.Mesh(
            new THREE.BoxGeometry(1.5,2,1.5),
            new THREE.MeshPhongMaterial({color:0xff0000})
        ));
    } else {
        const s=new THREE.Mesh(
            new THREE.ConeGeometry(0.7,2.2,16),
            new THREE.MeshStandardMaterial({
                color:0xff0055,
                emissive:0x550022,
                metalness:0.8,
                roughness:0.1
            })
        );
        g.add(s);

        const halo=new THREE.Mesh(
            new THREE.TorusGeometry(1.2,0.07,8,32),
            new THREE.MeshBasicMaterial({color:0xff00ff,transparent:true,opacity:0.4})
        );
        halo.rotation.x=Math.PI/2;
        g.add(halo);
    }

    g.position.set(l*laneWidth,1.5,z);
    g.userData.lane=l;
    scene.add(g);
    obstacles.push(g);
}

function createCollectible(z){
    const l=Math.floor(Math.random()*3)-1;
    const g=new THREE.Group();

    if(prototype){
        g.add(new THREE.Mesh(
            new THREE.SphereGeometry(0.5,8,8),
            new THREE.MeshPhongMaterial({color:0xffff00})
        ));
    } else {
        const crystal=new THREE.Mesh(
            new THREE.OctahedronGeometry(0.6,1),
            new THREE.MeshStandardMaterial({
                color:0x00ffff,
                emissive:0x002244,
                metalness:0.7,
                roughness:0.1,
                transparent:true,
                opacity:0.85
            })
        );
        g.add(crystal);

        const ring=new THREE.Mesh(
            new THREE.TorusGeometry(0.9,0.06,8,32),
            new THREE.MeshBasicMaterial({color:0x00ffff,transparent:true,opacity:0.35})
        );
        ring.rotation.x=Math.PI/2;
        g.add(ring);
    }

    g.position.set(l*laneWidth,2,z);
    g.userData.lane=l;
    scene.add(g);
    collectibles.push(g);
}

function createInitialPlatforms(){
    for(let i=0;i<15;i++)createPlatform(-10-i*10);
}

function createTunnel(){
    for(let i=0;i<20;i++){
        for(let s=-1;s<=1;s+=2){
            const wall=new THREE.Mesh(
                new THREE.BoxGeometry(1,8,10),
                new THREE.MeshPhongMaterial({
                    color:prototype?0x111111:0x222244,
                    transparent:true,
                    opacity:prototype?0.3:0.2
                })
            );
            wall.position.set(s*6,4,-10-i*10);
            scene.add(wall);
        }
    }
}

function moveLane(d){
    lane=Math.max(-1,Math.min(1,lane+d));
}

function jump(){
    if(!jumping&&running){
        jumping=true;
        jumpVel=jumpPower;
    }
}

function update(){
    if(!running)return;

    player.position.x+=(lane*laneWidth-player.position.x)*0.15;

    if(!prototype)player.rotation.y=Math.sin(Date.now()*0.005)*0.15;

    if(jumping){
        player.position.y+=jumpVel;
        jumpVel+=gravity;
        if(player.position.y<=2){
            player.position.y=2;
            jumping=false;
            jumpVel=0;
        }
    }

    platforms.forEach((p,i)=>{
        p.position.z+=speed;
        if(p.position.z>20){
            scene.remove(p);
            platforms.splice(i,1);
            createPlatform(-140);
        }
    });

    for(let i=obstacles.length-1;i>=0;i--){
        const o=obstacles[i];
        o.position.z+=speed;

        if(Math.abs(o.position.z-player.position.z)<1.5 &&
           o.userData.lane===lane && !jumping){
            gameOver();
        }

        if(o.position.z>10){
            scene.remove(o);
            obstacles.splice(i,1);
        }
    }

    for(let i=collectibles.length-1;i>=0;i--){
        const c=collectibles[i];
        c.position.z+=speed;

        if(!prototype)c.rotation.y+=0.1;

        if(Math.abs(c.position.z-player.position.z)<1.5 &&
           c.userData.lane===lane){
            score+=10+combo;
            combo++;
            maxCombo=Math.max(maxCombo,combo);
            scene.remove(c);
            collectibles.splice(i,1);
            spawnParticles(c.position);
            speed=Math.min(0.35,0.15+score*0.0001);
        }

        if(c.position.z>10){
            scene.remove(c);
            collectibles.splice(i,1);
            combo=0;
        }
    }

    particles.forEach((p,i)=>{
        p.life--;
        p.position.add(p.velocity);
        p.material.opacity-=0.02;
        if(p.life<=0||p.material.opacity<=0){
            scene.remove(p);
            particles.splice(i,1);
        }
    });

    document.getElementById("score").textContent=score;
    document.getElementById("speed").textContent=(speed/0.15).toFixed(1)+"x";
    document.getElementById("combo").textContent=combo;
}

function spawnParticles(pos){
    for(let i=0;i<15;i++){
        const p=new THREE.Mesh(
            new THREE.SphereGeometry(0.1,8,8),
            new THREE.MeshBasicMaterial({
                color:Math.random()>0.5?0x00ffff:0xffff00,
                transparent:true,
                opacity:1
            })
        );
        p.position.copy(pos);
        p.velocity=new THREE.Vector3(
            Math.random()*0.2-0.1,
            Math.random()*0.2,
            Math.random()*0.2-0.1
        );
        p.life=50;
        scene.add(p);
        particles.push(p);
    }
}

function toggleMode(){
    prototype=!prototype;
    document.getElementById("mode").textContent=prototype?"Prototype":"Full";
    document.getElementById("modeToggle").textContent=prototype?"Switch to Full Mode":"Switch to Prototype Mode";
    resetScene();
    createPlayer();
    createInitialPlatforms();
}

function resetScene(){
    [...platforms,...obstacles,...collectibles,...particles].forEach(o=>scene.remove(o));
    platforms=[]; obstacles=[]; collectibles=[]; particles=[];
}

function gameOver(){
    running=false;
    document.getElementById("finalScore").textContent=score;
    document.getElementById("maxCombo").textContent=maxCombo;
    document.getElementById("gameOver").style.display="block";
}

function restart(){
    resetScene();
    score=0; combo=0; maxCombo=0;
    speed=0.15;
    lane=0;
    jumping=false;
    running=true;
    createPlayer();
    createInitialPlatforms();
    document.getElementById("gameOver").style.display="none";
}

function inputs(){
    document.getElementById("left").onclick=()=>moveLane(-1);
    document.getElementById("right").onclick=()=>moveLane(1);
    document.getElementById("jump").onclick=()=>jump();
    document.getElementById("modeToggle").onclick=()=>toggleMode();
    document.getElementById("restart").onclick=()=>restart();

    /* SPACEBAR FIX */
    document.getElementById("modeToggle").onkeydown = e => e.preventDefault();

    addEventListener("keydown",e=>{
        if(e.key==="ArrowLeft"||e.key==="a")moveLane(-1);
        if(e.key==="ArrowRight"||e.key==="d")moveLane(1);
        if(e.key===" "){ e.preventDefault(); jump(); }
    });

    addEventListener("mousemove",e=>{
        const mx=(e.clientX/innerWidth)*2-1;
        if(mx<-0.33)lane=-1;
        else if(mx>0.33)lane=1;
        else lane=0;
    });
}

function animate(){
    requestAnimationFrame(animate);
    update();
    camera.updateProjectionMatrix();
    renderer.render(scene,camera);
}

init();

</script>
</body>
</html>